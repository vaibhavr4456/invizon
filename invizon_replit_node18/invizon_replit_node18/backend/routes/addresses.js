const express = require('express'); const router = express.Router(); const db = require('../db'); const { nanoid } = require('nanoid'); const { auth } = require('./auth'); router.get('/', auth, (req,res)=>{ db.all('SELECT * FROM addresses WHERE user_id=?',[req.user.id], (err,rows)=> { if(err) return res.status(500).json({error:'db'}); res.json(rows); }); }); router.post('/', auth, (req,res)=>{ const { name,street,city,state,zip,phone } = req.body; const id = nanoid(); db.run('INSERT INTO addresses (id,user_id,name,street,city,state,zip,phone) VALUES (?,?,?,?,?,?,?,?)',[id,req.user.id,name,street,city,state,zip,phone], function(err){ if(err) return res.status(500).json({error:'db'}); res.json({id,name,street,city,state,zip,phone}); }); }); router.delete('/:id', auth, (req,res)=>{ db.run('DELETE FROM addresses WHERE id=? AND user_id=?',[req.params.id, req.user.id], function(err){ if(err) return res.status(500).json({error:'db'}); res.json({success:true}); }); }); module.exports = router;
