const express = require('express'); const router = express.Router(); const db = require('../db'); router.get('/', (req,res)=>{ const search = req.query.search || ''; const where = search ? "WHERE title LIKE '%"+search+"%' OR description LIKE '%"+search+"%'" : ''; db.all(`SELECT * FROM products ${where} ORDER BY rowid DESC LIMIT 100`, [], (err,rows)=>{ if(err) return res.status(500).json({error:'db'}); rows.forEach(r=> r.images = JSON.parse(r.images||'[]')); res.json(rows); }); }); router.get('/:id', (req,res)=>{ db.get('SELECT * FROM products WHERE id=?',[req.params.id], (err,row)=>{ if(err) return res.status(500).json({error:'db'}); if(!row) return res.status(404).json({error:'Not found'}); row.images = JSON.parse(row.images||'[]'); res.json(row); }); }); module.exports = router;
